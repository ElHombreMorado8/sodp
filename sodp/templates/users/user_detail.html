{% extends "base.html" %}
{% load i18n %}

{% load static %}

{% block content %}

{% if object == request.user %}
<div>
  <p><label>{% trans "Latest 5 reports" %}:</label> <select id="latestReports">
    {% for report in reports %}
    <option value="{{ report.pk }}">{{ report.viewName }} - {{ report.dateFrom }} / {{ report.dateTo }}</option>
    {% endfor %}
  </select>
</div>

<div>
    <canvas id="lineChart" height="200" width="800"></canvas>
</div>
<div>
  <canvas id="pieChart" width="400"></canvas>
</div>
<div>
  <div id="rankingChart" ></div>
</div>

{% endif %}

{% endblock content %}

{% block inline_javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="/static/js/chartjs-plugin-colorschemes.min.js"></script>
<script type="text/javascript">
function ajax_chart(chart, url) {
        var data = {};

        $.getJSON(url, data).done(function(response) {
            chart.data.labels = response.data.labels;
            chart.data.datasets = response.data.datasets;
            chart.update(); // finally update our chart
        });
    }


    $(document).ready(function() {
      var ctx = document.getElementById('lineChart').getContext('2d');
      
      var chart = new Chart(ctx, {        
          type: 'line',
          data: {},
          options: {
            responsive: true,
            interaction: {
              mode: 'index',
              intersect: false,
            },
            stacked: false,
            plugins: {
              title: {
                display: true,
                text: 'Organic sessions per URL'
              },
              colorschemes: {
                scheme: 'tableau.Tableau20'

              }              
            },
          }          
      },{});

      first_id = $("#latestReports option:first").val();
      $("#latestReports").val(first_id);
      ajax_chart(chart, "/reports/dashboard/"+first_id);

      $("#latestReports").on('change', function (event) {
        ajax_chart(chart, "/reports/dashboard/"+this.value);
      });

    });
</script>
{% endblock inline_javascript %}

